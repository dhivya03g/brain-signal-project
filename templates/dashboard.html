<!DOCTYPE html>
<html>
<head>
<title>Digital Twin Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    margin:0;
    font-family:Segoe UI;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
}

.header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:20px 40px;
    background:rgba(0,0,0,0.3);
}

.header h2{
    margin:0;
}

.header a{
    color:white;
    text-decoration:none;
    margin-left:20px;
}

.container{
    text-align:center;
    margin-top:40px;
}

.value{
    font-size:60px;
    font-weight:bold;
}

.status{
    font-size:22px;
    margin-top:10px;
}

.risk{
    font-size:18px;
    margin-top:5px;
}

.circle{
    width:150px;
    height:150px;
    border-radius:50%;
    margin:30px auto;
    animation:blink 1s infinite;
}

.green{ background:#00ff00; }
.red{ background:#ff2e2e; }

@keyframes blink{
    0%{opacity:1;}
    50%{opacity:0.4;}
    100%{opacity:1;}
}

.chart-box{
    width:80%;
    margin:auto;
    margin-top:30px;
}
</style>
</head>

<body>

<div class="header">
    <h2>ðŸ§  Digital Twin Dashboard</h2>
    <div>
        <a href="/">Home</a>
        <a href="/admin">Admin</a>
        <a href="/logout">Logout</a>
    </div>
</div>

<div class="container">
    <div class="value" id="val">0</div>
    <div class="status" id="status">Status: -</div>
    <div class="risk" id="risk">Risk: 0%</div>

    <div id="circle" class="circle green"></div>

    <div class="chart-box">
        <canvas id="chart"></canvas>
    </div>
</div>

<script>
let ctx=document.getElementById("chart").getContext("2d");

let chart=new Chart(ctx,{
type:'line',
data:{
    labels:[],
    datasets:[{
        label:"Brain Signal",
        data:[],
        borderColor:"cyan",
        borderWidth:2,
        fill:false
    }]
},
options:{
    scales:{
        y:{beginAtZero:true}
    }
}
});

function update(){
fetch('/api/health')   // IMPORTANT
.then(res=>res.json())
.then(d=>{

document.getElementById("val").innerText=d.value;
document.getElementById("status").innerText="Status: "+d.status;
document.getElementById("risk").innerText="Risk: "+d.risk+"%";

let circle=document.getElementById("circle");

if(d.status=="Abnormal"){
circle.className="circle red";
}else{
circle.className="circle green";
}

chart.data.labels.push("");
chart.data.datasets[0].data.push(d.value);

if(chart.data.labels.length>20){
chart.data.labels.shift();
chart.data.datasets[0].data.shift();
}

chart.update();
});
}

setInterval(update,2000);
</script>

</body>
</html>