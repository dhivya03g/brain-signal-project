<!DOCTYPE html>
<html>
<head>
    <title>Brain Signal Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            margin: 0;
            font-family: Arial;
            background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
            color: white;
        }

        .topbar{
            display:flex;
            justify-content:space-between;
            padding:20px;
        }

        .dashboard{
            display:flex;
            flex-wrap:wrap;
            justify-content:center;
            gap:25px;
            padding:20px;
        }

        .card{
            width:250px;
            background:rgba(255,255,255,0.08);
            padding:25px;
            border-radius:15px;
            text-align:center;
        }

        .value{
            font-size:30px;
            font-weight:bold;
        }

        .normal{ color:#00ff99; }
        .abnormal{ color:#ff4d4d; }

        canvas{
            background:#fff;
            border-radius:10px;
        }
    </style>
</head>

<body>

<div class="topbar">
    <h2>ðŸ§  Brain Signal Monitoring</h2>
    <div>
        <a href="/admin" style="color:cyan">Admin</a>
        <a href="/logout" style="color:cyan;margin-left:15px">Logout</a>
    </div>
</div>

<div class="dashboard">

    <div class="card">
        <h3>EEG Value</h3>
        <div class="value eeg">{{ eeg }}</div>
    </div>

    <div class="card">
        <h3>Status</h3>
        <div class="value status {% if 'Abnormal' in status %}abnormal{% else %}normal{% endif %}">
            {{ status }}
        </div>
    </div>

    <div class="card">
        <h3>Risk %</h3>
        <div class="value risk">{{ risk }}%</div>
    </div>

    <div class="card">
        <h3>Model Accuracy</h3>
        <div class="value">{{ (accuracy*100)|round(1) }}%</div>
    </div>

    <div class="card" style="width:600px">
        <h3>Live EEG Graph</h3>
        <canvas id="chart"></canvas>
    </div>

</div>

<script>
const ctx = document.getElementById('chart').getContext('2d');
let dataArr = [{{ eeg }}];

const chart = new Chart(ctx,{
    type:'line',
    data:{
        labels:dataArr.map((_,i)=>i),
        datasets:[{
            label:'EEG',
            data:dataArr,
            borderColor:'cyan'
        }]
    }
});

setInterval(async()=>{
    const res = await fetch('/api/health');
    const d = await res.json();

    document.querySelector('.eeg').innerText = d.eeg;
    document.querySelector('.status').innerText = d.status;
    document.querySelector('.risk').innerText = d.risk + "%";

    dataArr.push(d.eeg);
    if(dataArr.length>20) dataArr.shift();

    chart.data.labels = dataArr.map((_,i)=>i);
    chart.data.datasets[0].data = dataArr;
    chart.update();

},2000);
</script>

</body>
</html>